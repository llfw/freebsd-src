# LF kernel for generic ARM systems.

cpu		ARM64
ident		LF

include "../../conf/std.nodebug"
include "../../conf/std.lf"

makeoptions	DEBUG=-g		# Build kernel with gdb(1) debug symbols
#makeoptions	WITH_CTF=1		# Run ctfconvert(1) for DTrace support

options 	EFIRT			# EFI Runtime Services support
options 	KBD_INSTALL_CDEV	# install a CDEV entry in /dev
options 	HWPMC_HOOKS		# Necessary kernel hooks for hwpmc(4)
options 	VFP			# Floating-point support
options 	LINUX_BOOT_ABI		# Boot using booti command from U-Boot
options 	PERTHREAD_SSP		# Per-thread SSP canary

# Bus drivers
device		pci
options 	PCI_HP			# PCI-Express native HotPlug
options 	PCI_IOV			# PCI SR-IOV support

# CPU frequency control
device		cpufreq

# Block devices
device		scbus
device		da
device		cd
device		pass
device		nvme			# base NVMe driver
options 	NVME_USE_NVD=0		# prefer the cam(4) based nda(4) driver

# GPIO / PINCTRL
device		gpio
device		gpioled
device		fdt_pinctrl
device		gpioregulator

# I2C
#device		iicbus
#device		iicmux
#device		iic
#device		icee			# Generic IIC eeprom

# Crypto accelerators
device		armv8crypto		# ARMv8 OpenCrypto module

# SPI
device		spibus

# PWM
device		pwm

# Serial (COM) ports
device		uart			# Generic UART driver

# Console
device		vt
device		kbdmux

device		vt_efifb
device		vt_simplefb

# Pseudo devices.
device		crypto			# core crypto support
device		armv8_rng		# Armv8.5 rndr RNG
device		loop			# Network loopback
device		ether			# Ethernet support
device		firmware		# firmware assist module
device		clk
device		phy
device		hwreset
device		nvmem
device		regulator
device		syscon

device		bpf		# Berkeley packet filter

device		netmap			# netmap(4) support

options 	USB_HOST_ALIGN=64	# Align usb buffers to cache line size.

# Firmware
device		mmio_sram		# Generic on-chip SRAM

options 	SOC_APPLE_T8103
#options 	IOMMU
options 	FDT

#device		pci_n1sdp		# ARM Neoverse N1 SDP PCI
device		pl061			# Arm PL061 GPIO controller
device		pl031			# Arm PL031 RTC
device		pl011
device		scmi			# System Control Management Interface
device		arm_doorbell		# ARM Message Handling Unit (MHU)
options 	FDT
device		acpi
device		acpi_ged

# SoC support
options 	SOC_BRCM_BCM2837
options 	SOC_BRCM_BCM2838
options 	SOC_BRCM_NS2
device		bcm2835_bsc		# Broadcom BCM283x I2C bus
device		bcm2835_spi		# Broadcom BCM283x SPI bus
device		uart_mu			# RPI3 aux port
device		dwcotg
device		sdhci
makeoptions	MODULES_EXTRA+="dtb/rpi"

options 	MMCCAM
#options 	CAMDEBUG

nodevice	mmc
nodevice	mmcsd

device		iicbus
device		mdio

device		mii
device		miibus
device		genet			# Broadcom on RPi4
device		dwcotg

# DTBs
makeoptions	MODULES_EXTRA+="dtb/rpi"
